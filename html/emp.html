<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    @@include('layout/head.html')
    <title>員工後台</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/member.css">
    <link rel="stylesheet" href="css/calendar.css">
    <link rel="stylesheet" href="css/emp.css">
</head>
<body>
    <!-- @@include('layout/header.html') -->
    <main  id="emp_data">
        <!-- 左側選單 ---------------------------->
        <section class="data_column">
            <!-- 功能欄--各細項 data_button ------------------>
            <div class="data_button">
                <input type="checkbox" id="m_data">
                <label for="m_data" class="id">
                    <div class="mem">
                        <div class="mem_icon">
                            <img :src="emp_pic">
                        </div>
                        <div class="mem_p">
                            <!-- 名字 -->
                            <p>{{empRow.EMP_NAME}}</p>
                        </div>
                        <img src="img/memupupdowndown.png" alt="" class="up_down">
                    </div>
                </label>
                <div class="con_data">
                    <a>工作行程</a><br>
                    <a>工作紀錄</a><br>
                    <a id="btnLogout" @click="logout">登出</a>
                </div>
            </div>
        </section>

        <!-- 員工資料 -------------------------->
        <section class="data_con">
            <!-- 資料區的頭上槓槓 -->
            <div class="title_color"></div>
            <!-- 資料區的內容盒子 data_mem------------------>
            <!-- 工作行程 -->
            <div class="data_mem emp_sch center">
                <!-- 預約明細 -->
                <!-- <div class="datails_info flex">
                    <table class="d_table">
                        <tr>
                            <td>姓名</td>
                            <td>客戶姓名</td>
                        </tr>
                        <tr>
                            <td>電話</td>
                            <td>客戶電話</td>
                        </tr>
                        <tr>
                            <td>地址</td>
                            <td>客戶的地址</td>
                        </tr>
                        <tr>
                            <td>預約方案</td>
                            <td>客戶的預約方案</td>
                        </tr>
                        <tr>
                            <td>整理師</td>
                            <td>選你去!!!</td>
                        </tr>
                        <tr>
                            <td>預約日期</td>
                            <td>客戶的預約日期</td>
                        </tr>
                        <tr>
                            <td>預約時段</td>
                            <td>客戶的預約時段</td>
                        </tr>
                        <tr>
                            <td>需求</td>
                            <td>客戶需求放在這裡</td>
                        </tr>

                    </table>
                    <div class="d_pic center">
                        <img id="info_pic" src="https://picsum.photos/300/200/?random=10">
                    </div>
                </div> -->

                <!-- 月曆 -->
                <div class="emp_calendar">
                    <button class="btn_btn br btn_job absolute" type="button">請假</button>

                    <div id="calendari"></div>
                </div>
                <!-- 我是預約明細 ------------------------------->
                <div class="data_list" id="lightbox">
                    <button type="button" class="btn_btn" @click="close_lightbox">×</button>
                    
                    <div class="memberReserve">
                        <div class="memberReserveContent">
                            <div class="memberGrid">
                                <div class="memberGrid1">預約時間</div>
                                <div class="memberGrid2">預約時段</div>
                                <div class="memberGrid3">預約人</div>
                                <div class="memberGrid4">預約方案</div>
                                <div class="memberGrid5">預約地址</div>
                                <div class="memberGrid6">電話</div>
                                <div class="memberGrid7">預約狀態</div>
                                <!-- <div class="memberGrid8">TEL</div> -->
                                <div class="memberGrid9"> SAO_DATE </div>
                                <div class="memberGrid10"> SAO_TIME </div>
                                <div class="memberGrid11"> 誰預約NAME </div>
                                <div class="memberGrid12"> PLAN </div>
                                <div class="memberGrid13"> ADDRESS </div>
                                <div class="memberGrid14"> TEL </div>
                                <div class="memberGrid15"> 未完成 </div>

                                <!-- <div class="memberGrid16 memberReceiverID">項目16</div> -->
                            </div>
                        </div>
                
                        <div class="memberReserveDetailHere">
                            <div class="memberReserveDetailAll">
                                <div class="memberReserveDetail">
                                    <div class="memberReserveD1">
                                        <div>顧客需求</div>
                                    </div>
                                    <div href="product.html" class="memberOrderD2">
                                        <p class="needs">顧客的需求</p>
                                    </div>
                                </div>
                                <div class="memberReserveDetail">
                                    <div class="memberReserveD1">
                                        <div>顧客環境照</div>
                                    </div>
                                    <div href="product.html" class="memberOrderD2 sao_pics">
                                        <p id='none'>無</p>
                                        <img class="sao_pic1" src="">
                                        <img class="sao_pic2" src="">
                                        <img class="sao_pic3" src="">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ------------預約明細結束 -->

            </div>



            <!-- 工作紀錄 -->
            <div class="data_mem">

            </div>
        </section>

    </main>
    <!-- ------------ 我是Vue分隔線 ------------ -->
        <script >
            let vm = new Vue({
                el:'#emp_data',
                data:{
                    emp_pic:'img/cus/emp_img.jpg', // 預設大頭貼
                    empRow:[],
                    saoinfos:[],
                    schinfos:[],
                },
                methods: {
                    getEmpInfo(){
                        let xhr = new XMLHttpRequest();
                        let thisVue = this;
                        xhr.onload = function(){
                            thisVue.empRow = JSON.parse(xhr.responseText);
                            console.log(thisVue.empRow);
                            if(thisVue.empRow.EMP_PIC!=''){
                                thisVue.emp_pic = "img/"+thisVue.empRow.EMP_PIC; // 大頭貼路徑
                            }  
                        }
                        xhr.open("get", "phps/getEmpInfo.php", true);
                        xhr.send(null);
                    },
                    getsao(){
                        let thisVue = this;
                        
                        $.ajax({
                            url: `phps/getEmpSao.php`,
                            // data: `data=${empRow.EMP_NO}`, 
                            type: 'GET', 
                            dataType: 'json', 
                            success(res){
                                let tds = $("#calendari td");
                                thisVue.saoinfos = res;
                                // 有幾筆預約訂單跑幾次
                                for(let i=0; i<thisVue.saoinfos.length; i++){
                                    console.log("SAO_DATE",thisVue.saoinfos[i].SAO_DATE);
                                    console.log("SAO_TIME",thisVue.saoinfos[i].SAO_TIME);
                                    // for(let j=0; j<tds.length; j++){
                                    //     console.log(tds[j].dataset.date);
                                    // }
                                    for(let j=0; j<tds.length; j++){
                                        if(thisVue.saoinfos[i].SAO_DATE == tds[j].dataset.date){
                                            // 早中晚點點加上reserved
                                            if(thisVue.saoinfos[i].SAO_TIME == 1){
                                                tds[j].childNodes[0].childNodes[1].childNodes[0].classList.add('reserved');
                                            }else if(thisVue.saoinfos[i].SAO_TIME==2){
                                                tds[j].childNodes[0].childNodes[1].childNodes[1].classList.add('reserved');
                                            }else if(thisVue.saoinfos[i].SAO_TIME==3){
                                                tds[j].childNodes[0].childNodes[1].childNodes[2].classList.add('reserved');
                                            }                                        tds[j].onclick = function (){
                                                $("#lightbox").toggle().show();
                                                console.log(thisVue.saoinfos[i].SAO_DATE);
                                                // console.log($(".memberGrid9").text());
                                                $(".memberGrid9").text(thisVue.saoinfos[i].SAO_DATE);
                                                
                                                $sao_time = "";
                                                if(thisVue.saoinfos[i].SAO_TIME == 1){$sao_time = "早上9~12點"
                                            }else if(thisVue.saoinfos[i].SAO_TIME == 2){
                                                $sao_time = "下午12~17點"
                                            }else if(thisVue.saoinfos[i].SAO_TIME == 3){
                                                $sao_time = "晚上18~21點"
                                            }
                                            $(".memberGrid10").text($sao_time);
                                            $(".memberGrid11").text(thisVue.saoinfos[i].SAO_NAME);
                                            $(".memberGrid12").text(thisVue.saoinfos[i].PLAN_NAME);
                                            $(".memberGrid13").text(thisVue.saoinfos[i].SAO_ADD); 

                                            // 需求
                                            if(thisVue.saoinfos[i].NEEDS == "" || thisVue.saoinfos[i].NEEDS == null){
                                                thisVue.saoinfos[i].NEEDS = "無"
                                            }
                                            $(".needs").text(thisVue.saoinfos[i].NEEDS); 
                                                      
                                            if(thisVue.saoinfos[i].UPLOAD_PIC1 == "" || thisVue.saoinfos[i].UPLOAD_PIC1 == null){
                                                $("#none").show();
                                                $(".sao_pic1").hide();
                                                $(".sao_pic2").hide();
                                                $(".sao_pic3").hide();
                                            }else{ // 有圖
                                                $("#none").hide();
                                                $(".sao_pic1").show();
                                                $(".sao_pic2").show();
                                                $(".sao_pic3").show();

                                                $(".sao_pic1").attr("src","img/reserve/"+thisVue.saoinfos[i].UPLOAD_PIC1);
                                                if(thisVue.saoinfos[i].UPLOAD_PIC2 != null)
                                                $(".sao_pic2").attr("src","img/reserve/"+thisVue.saoinfos[i].UPLOAD_PIC2);
                                                if(thisVue.saoinfos[i].UPLOAD_PIC3 != null)
                                                $(".sao_pic3").attr("src","img/reserve/"+thisVue.saoinfos[i].UPLOAD_PIC3);
                                            }
                                            
                                        }  
                                        }
                                    }
                                }
                            },
                            error(res){
                                console.log('error');
                                console.log(res);
                            },
                        });
                    },
                    getsch(){
                        let thisVue = this;
                        
                        $.ajax({
                            url: `phps/getEmpSch.php`,
                            // data: `data=${empRow.EMP_NO}`, 
                            type: 'GET', 
                            dataType: 'json',
                            success(res){
                                let tds = $("#calendari td");
                                thisVue.schinfos = res;

                                for(let i=0; i<thisVue.schinfos.length; i++){
                                    console.log("DAY_OFF",thisVue.schinfos[i].DAY_OFF);
                                    console.log("SCH_TIME",thisVue.schinfos[i].SCH_TIME);

                                    for(let j=0; j<tds.length; j++){
                                        if(thisVue.schinfos[i].DAY_OFF == tds[j].dataset.date){
                                            // 早中晚點點加上reserved
                                            if(thisVue.schinfos[i].SCH_TIME == 1){
                                                tds[j].childNodes[0].childNodes[1].childNodes[0].classList.add('leave');
                                            }else if(thisVue.schinfos[i].SCH_TIME==2){
                                                tds[j].childNodes[0].childNodes[1].childNodes[1].classList.add('leave');
                                            }else if(thisVue.schinfos[i].SCH_TIME==3){
                                                tds[j].childNodes[0].childNodes[1].childNodes[2].classList.add('leave');
                                            }                                        tds[j].onclick = function (){
                                                // $("#lightbox").toggle().show();
                                                // console.log($(".memberGrid9").text());
                                                $(".memberGrid9").text(thisVue.saoinfos[i].SAO_DATE);
                                                
                                            }  
                                        }
                                    }
                                }
                            },
                            error(res){
                                console.log('error');
                                console.log(res);
                            },
                        })
                    },
                    logout(){        
                        let xhr = new XMLHttpRequest();
                        xhr.onload = function(){
                            // 跳轉畫面
                            window.location.assign("backendlogin.html");       
                        }
                        xhr.open("get", "phps/logout.php", true); // 清空session
                        xhr.send(null);
                    },
                    close_lightbox(){
                        $("#lightbox").toggle().hide();
                        this.getsao();
                        this.getsch();
                    },
                },
                mounted() {
                    this.getEmpInfo();
                    this.getsao();
                    this.getsch();
                },
            });
        </script>
<!-- <script src="js/member.js"></script> -->
<script src="js/calendar_emp.js"></script>
</body>
</html>