<!DOCTYPE html>
<html lang="en">
<head>
    <!-- 初始設定，請自行修改title，及添加js連結 -->
    @@include('layout/head.html')
    <title>整理人格測驗</title>
    <link rel="stylesheet" href="css/game.css">
    <script src="js/game.js"></script>
</head>
<body>
    <!-- <header></header> -->
    @@include('layout/header.html')

    <main id="app">
        <!-- 測驗說明 -->
        <section class="text_ill">
            <div class="welcome">
                <h2>測驗說明</h2>
                <div class="txt">
                    <p>不同人格，收納習慣也大不同</p>
                    <p>你是收納苦手嗎？</p>
                    <p>來找出你的收納昆蟲人格吧！</p>
                    <div class="pic">
                        <img src="img/game_butterfly.png" alt="">
                        <img src="img/game_ladybug.png" alt="">
                        <img src="img/game_bee.png" alt="">
                        <img src="img/game_cricket.png" alt="">
                    </div>
                </div>
                <button class="btn_btn rd">開始測驗</button>
            </div>
            
            <div class="intr">
                <h2>遊玩方法</h2>
                <div class="pic">
                    <img src="https://cdn-icons-png.flaticon.com/512/57/57213.png">
                    <img src="https://cdn-icons-png.flaticon.com/128/64/64797.png">
                    <img src="https://cdn-icons-png.flaticon.com/512/128/128236.png">
                </div>
                <div class="txt">
                    <p>點選物件再點擊框線即可放置物品。</p>
                </div>
                <div class="pic">
                    <img src="https://cdn-icons-png.flaticon.com/512/57/57213.png">
                    <img src="https://cdn-icons-png.flaticon.com/128/64/64797.png">
                    <img src="https://cdn-icons-png.flaticon.com/512/35/35444.png">
                </div>
                <div class="txt">
                    <p>點擊垃圾桶可以丟棄物品。</p>
                </div>
                <button class="btn_btn rd">前往臥室</button>
                <!-- <button class="btn_btn rd" disabled>前往廚房</button> -->
            </div>
        </section>

        <!-- 遊戲 -->
        <section class="text_game">
            <div class="pull">
                <div class="pullbox_group">
                    <div class="pullbox" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div class="pullbox" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div class="pullbox" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div class="pullbox" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div class="pullbox" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div class="pullbox" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div class="pullbox" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div class="pullbox" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div class="pullbox" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div class="pullbox" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <!-- 衣櫃 -->
                    <div id="wardrobe" ondrop="dropWardrobe(event)" ondragover="allowDrop(event)">
                        <img id="door1" src="img/game_room_door01.png">
                        <img id="door2" src="img/game_room_door02.png">
                        <div id="inside"></div>
                        <div id="hiding"></div>
                    </div>
                    <img id="bed" src="img/game_room_bed.png">
                    <img id="pull_arrow" src="https://cdn-icons-png.flaticon.com/512/158/158787.png">
                </div>
            </div>


            <!-- 垃圾桶 -->
            <div id="trashcan" ondrop="dropTrashcan(event)" ondragover="allowDrop(event)">
                <div class="pic">
                    <img src="img/game_trashcan1.png">
                    <img src="img/game_trashcan0.png">
                </div>
                <div id="garbage"></div>
            </div>
                    
            <div class="push">
                <div id="item_group" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <img id="room_item01" draggable="true" ondragstart="drag(event)" src="img/game_item_1.png">
                    <img id="room_item02" draggable="true" ondragstart="drag(event)" src="img/game_item_2.png">
                    <img id="room_item03" draggable="true" ondragstart="drag(event)" src="img/game_item_3.png">
                    <img id="room_item04" draggable="true" ondragstart="drag(event)" src="img/game_item_4.png">
                    <img id="room_item05" draggable="true" ondragstart="drag(event)" src="img/game_item_5.png">
                    <img id="room_item06" draggable="true" ondragstart="drag(event)" src="img/game_item_6.png">
                    <img id="room_item07" draggable="true" ondragstart="drag(event)" src="img/game_item_7.png">
                    <img id="room_item08" draggable="true" ondragstart="drag(event)" src="img/game_item_8.png">
                    <img id="room_item09" draggable="true" ondragstart="drag(event)" src="img/game_item_9.png">
                    <img id="room_item10" draggable="true" ondragstart="drag(event)" src="img/game_item_10.png">
                    <finish-button></finish-button>
                    <!-- <input id="finish" @click="judge" class="btn_sub rd" type="button" value="完成放置" disabled> -->
                </div>
            </div>
        </section>
        

        <!-- 測驗結果 -->
        <section class="text_result" id="result">
            <!-- <input type="text" v-model="personality" value="蝴蝶" hidden> -->
            <!-- <result-get></result-get> -->
            <img class="typewriter" src="img/game_typewriter.png" alt="打字機">
            <img class="typewriter" src="img/game_typewriter-01.png" alt="打字機">
            <button id="again" class="btn_sub rd">再玩一次</button>
            <div class="paper">
                <h2>測驗結果</h2>
                <div class="result">
                    <div class="evaluate">
                        <div class="txt">
                            <h3>你是{{yourpersonality[0]}}人！</h3>
                            <p class="text-wrapper">{{yourpersonality[1]}}</p>
                            <p class="text-wrapper">{{yourpersonality[2]}}</p>
                        </div>
                        <div>
                            <div class="pic">
                                <img :src='yourpersonality[5]'>
                                <!-- <img :src="img/game_bee.png"> -->
                            </div>
                            <div class="txt">
                                <h3>｜人格魅力｜</h3>
                                <p class="text-wrapper">{{yourpersonality[3]}}</p>
                                <h3>｜收納難題｜</h3>
                                <p class="text-wrapper">{{yourpersonality[4]}}</p>
                            </div>
                        </div>
                    </div>
                    <h3>推薦服務</h3>
                    <div class="push_service">
                        <h3>{{pushService.PLAN_NAME}}</h3>
                        <img src="img/service_08.jpg">
                        <div class="txt">
                            <h3>｜適合對象｜</h3>
                            <p class="text-wrapper">{{pushService.PLAN_TA}}</p>
                            <h3>｜方案特色｜</h3>
                            <p class="text-wrapper">{{pushService.PLAN_FEATURE}}</p>
                            <br>
                            <p>
                                <a href="reserve.html" class="link_btn rd">馬上預約</a>
                            </p>
                        </div>
                    </div>
                    <h3>推薦精品</h3>
                    <div class="push_products">
                        <div>
                            <div class="prd_card">
                                <img :src="'img/'+pushService.prd1_img">
                                <div class="txt">
                                    <p>{{pushService.prd1}}</p>
                                    <div>
                                        <p>NT ${{pushService.prd1_price}}</p>
                                        <p>
                                            <a href="product.html" class="link_btn bl">購買</a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="prd_card">
                                <img :src="'img/'+pushService.prd2_img">
                                <div class="txt">
                                    <p>{{pushService.prd2}}</p>
                                    <div>
                                        <p>NT ${{pushService.prd2_price}}</p>
                                        <p>
                                            <a href="product.html" class="link_btn bl">購買</a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="prd_card">
                                <img :src="'img/'+pushService.prd3_img">
                                <div class="txt">
                                    <p>{{pushService.prd3}}</p>
                                    <div>
                                        <p>NT ${{pushService.prd3_price}}</p>
                                        <p>
                                            <a href="product.html" class="link_btn bl">購買</a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        // MDN
        // https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/getData
        // 跨區域拖放受限，失敗原因 : 
        // https://stackoverflow.com/questions/11927309/html5-dnd-datatransfer-setdata-or-getdata-not-working-in-every-browser-except-fi
        
        // 送出按鈕disabled切換
        function finishButton(){
            // console.log(0);
            if($('#item_group img').length == 0) {
                $('#finish').attr('disabled',false);
            }else if($('#item_group img').length > 0){
                $('#finish').attr('disabled',true);
            };
        };

        function allowDrop(allowdropevent) {
            allowdropevent.preventDefault();
        };
        
        function drag(dragevent) {
            dragevent.dataTransfer.setData("text", dragevent.target.id);
        };
        
        function drop(dropevent) {
            dropevent.preventDefault();
            var data = dropevent.dataTransfer.getData("text");
            dropevent.target.appendChild(document.getElementById(data));
            finishButton();   // 送出按鈕disabled切換
        };
        
        function dropTrashcan(e) {
            e.preventDefault();
            var data = e.dataTransfer.getData("text");
            e.target.parentNode.parentNode.lastChild.appendChild(document.getElementById(data));
            if($('#trashcan #garbage img').length == 0){
                // 條件:垃圾桶是空的，顯示為空
                $('#trashcan').addClass('empty');
            }else{
                $('#trashcan').removeClass('empty');
            };
            finishButton();   // 送出按鈕disabled切換
        };
        
        function dropWardrobe(e) {
            e.preventDefault();
            var data = e.dataTransfer.getData("text");
            $('#hiding').append(document.getElementById(data));
            if($('#wardrobe #hiding img').length == 0){
                // 條件:衣櫃是空的，顯示為空
                $('#wardrobe #inside').addClass('empty');
            }else{
                $('#wardrobe #inside').removeClass('empty');
            };
            finishButton();   // 送出按鈕disabled切換
        };


        const bus = new Vue();

        Vue.component('finish-button',{
            // template: `<button> Add </button>`,
            template: `<input id="finish" @click="judge" class="btn_sub rd" type="button" value="完成放置" disabled>`,
            methods: {
                judge(){
                    if( $('#hiding img').length==1 && $('#garbage img').length<=1 ){
                        bus.$emit('abc',this.personality='蝴蝶');   // 自訂事件
                    }else if( $('#hiding img').length<=5 && $('#garbage img').length<=1 ){
                        bus.$emit('abc',this.personality='蜜蜂');   // 自訂事件
                    }else if( $('#hiding img').length>=5 && $('#garbage img').length<=3 ){
                        bus.$emit('abc',this.personality='瓢蟲');   // 自訂事件
                    }else{
                        bus.$emit('abc',this.personality='蟋蟀');   // 自訂事件
                    };
                },
                data() {
                    return {
                        personality: '',
                    };
                },
            },
        });

        new Vue({
            el:'#app',
			data:{
                yourpersonality: '',
                butterfly:['蝴蝶',
                    '用得到的、喜愛的物件都要在眼前一覽無遺，你才會感到安心。',
                    '你比較喜歡：「豐富視覺＋簡易收納」',
                    '你思考活躍、創意十足、著眼於大處，做事時樂在當下，珍惜和物品的感情連結。',
                    '你總是覺得，「東西要是收起來，我就會忘記它們的存在！」結果物品四處散亂堆積，櫃子、抽屜反而空空如也。\n你可能常被人認為懶惰、任空間亂七八糟，但那只是因為市面上的收納用品不符合你的習慣。\n既然東西要擺出來才安心，就讓自己當個被心愛物品圍繞的蝴蝶人吧！','img/game_butterfly.png'],
                ladybug:['瓢蟲',
                    '你能從宏觀角度掌握事物全貌，整潔有序，經手過的空間美得能拍網美照！',
                    '你比較喜歡：「簡潔視覺＋簡易收納」',
                    '你做事有條理，也有強盛的行動力，容易對手作DIY有熱情，生活過得充實精彩！',
                    '「那些帳單、藥罐、小東西通通都要收起來，眼不見為淨！」\n瓢蟲人的家看似整潔，其實他們有著難以啟齒的秘密──那些看不見的抽屜、櫃子早就大爆炸一團亂了！\n結果老是找不到要用的東西，每天都在跟雜物玩捉迷藏……要仔細整理真的很困難！','img/game_ladybug.png'],
                bee:['蜜蜂',
                    '你偏好讓所有事物在眼前自成秩序，並深信它們都能物盡其用。',
                    '你比較喜歡：「豐富視覺＋詳盡收納」',
                    '你做事有條理，也有強盛的行動力，容易對手作DIY有熱情，生活過得充實精彩！',
                    '「我的興趣很多，導致東西也很多！」忙碌的小蜜蜂被嗜好圍繞雖然幸福，但是空間也因此被各種器材用品塞爆。\n又因為常常想著「以後可能會用到啊！」結果割捨不下任何東西，只好通通堆在自己身邊。\n很想要找出完美的收納方式，但可能會先被雜物淹沒……','img/game_bee.png'],
                cricket:['蟋蟀',
                    '俐落有序、細節準則是你的人生信仰，你只用「正確方式」做事。',
                    '你比較喜歡：「簡潔視覺＋詳盡收納」',
                    '你擅長分析、注重細節、條理分明，任何事交給有責任感的你，絕對讓人放心！',
                    '市面上的收納用品根本是為蟋蟀人設計的，許多專業整理師也都是這個類型。\n但是你太追求完美，甚至覺得沒做好還不如完全別做，整理收納容易一拖再拖，反而更容易堆積物品，尤其文件是你難攻克的大魔王。\n請放下自我懷疑，並接受你天生的收納整理能力。','img/game_cricket.png'],
                pushService:{PLAN_FEATURE: "",PLAN_NAME: "",PLAN_TA: "",prd1: "",prd1_img: "",prd1_price: "",prd2: "",prd2_img: "",prd2_price: "",prd3: "",prd3_img: "",prd3_price:''},
            },
			methods: {
				getPushService(){
					let xhr = new XMLHttpRequest();
					let thisVue = this;
					xhr.onload = function(){
                        thisVue.pushService = JSON.parse(xhr.responseText);
					}
					xhr.open("get", `phps/getPush.php?personality=${thisVue.yourpersonality[0]}`, true);
					xhr.send(null);
				},
			},
            // 在 mounted() 時聆聽該事件
            mounted() {
                bus.$on('abc',(personality) => {
                    if(personality=='蝴蝶'){
                        this.yourpersonality=this.butterfly;
                    }else if(personality=='瓢蟲'){
                        this.yourpersonality=this.ladybug;
                    }else if(personality=='蜜蜂'){
                        this.yourpersonality=this.bee;
                    }else if(personality=='蟋蟀'){
                        this.yourpersonality=this.cricket;
                    };
                    this.getPushService();
                });
            },
        });
    </script>
</body>
</html>